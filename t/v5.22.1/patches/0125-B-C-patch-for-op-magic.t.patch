From bf4869b2fb2088e586ff7abb90cfac146aa240e7 Mon Sep 17 00:00:00 2001
From: Nicolas Rochelemagne <rochelemagne@cpanel.net>
Date: Tue, 29 Sep 2015 14:35:47 -0500
Subject: [PATCH 125/211] B::C patch for op/magic.t

---
 t/op/magic.t | 11 +++++++----
 1 file changed, 7 insertions(+), 4 deletions(-)

diff --git a/t/op/magic.t b/t/op/magic.t
index 4a8006d..1c2e2f5 100644
--- a/t/op/magic.t
+++ b/t/op/magic.t
@@ -2,18 +2,19 @@
 
 BEGIN {
     $| = 1;
-    chdir 't' if -d 't';
-    @INC = '../lib';
+    chdir 't' if -d 't';    
     require './test.pl';
-    plan (tests => 190);
+    set_up_inc( '../lib' );    
 }
 
+plan (tests => 190);
+
 # Test that defined() returns true for magic variables created on the fly,
 # even before they have been created.
 # This must come first, even before turning on warnings or setting up
 # $SIG{__WARN__}, to avoid invalidating the tests.  warnings.pm currently
 # does not mention any special variables, but that could easily change.
-BEGIN {
+{
     # not available in miniperl
     my %non_mini = map { $_ => 1 } qw(+ - [);
     for (qw(
@@ -62,6 +63,8 @@ $PERL =
     $Is_MSWin32 ? '.\perl' :
                   './perl');
 
+$PERL = $^X;
+
 sub env_is {
     my ($key, $val, $desc) = @_;
 
-- 
2.5.0

